{% extends 'bedesk/base.html' %}

{% block title %}Horários - {{ sala.nome }}{% endblock %} {% block content %}
<div class="container-fluid mt-4">
    
    <h2 class="text-center mb-4">Horários -  {{ sala.nome }}</h2>

    <div class="table-responsive">
        <table class="table table-bordered table-hover shadow-sm text-center">
            
            <thead class="table-dark">
                <tr>
                    <th style="width: 12%;">Horário</th>
                    
                    {% for dia_nome in dias_semana_nomes %}
                        <th style="width: 17.6%;">{{ dia_nome }}</th>
                    {% endfor %}
                    
                </tr>
            </thead>

            <tbody>
                {% for linha in tabela_horarios %}
                    
                    {% comment %} TIPO 1: Linha Separadora (Manhã/Tarde) {% endcomment %}
                    {% if linha.tipo == 'separador' %}
                        <tr class="table-light">
                            <td colspan="6" class="text-center fw-bold fs-5">
                                {{ linha.nome }}
                            </td>
                        </tr>

                    {% comment %} TIPO 2: Linha de Intervalo {% endcomment %}
                    {% elif linha.tipo == 'intervalo' %}
                        <tr class="table-secondary text-muted">
                            <td class="align-middle">
                                {{ linha.inicio }} às {{ linha.fim }}
                            </td>
                            <td colspan="5" class="align-middle fst-italic">
                                {{ linha.nome }}
                            </td>
                        </tr>

                    {% comment %} TIPO 3: Linha de Horário Normal {% endcomment %}
                    {% elif linha.tipo == 'hora' %}
                        <tr>
                            <td class="align-middle fw-bold">
                                {{ linha.horario_str }}
                            </td>
                            
                            {% for celula in linha.celulas %}
                                <td class="align-middle">
                                    
                                    {% if celula.agendamento %}
    <div class="d-flex flex-column justify-content-center align-items-center h-100">
        
        <span class="text-danger fw-bold text-uppercase" 
              style="font-size: 0.9em;" 
              data-bs-toggle="tooltip" 
              title="Motivo: {{ celula.agendamento.motivo }}">
            {{ celula.agendamento.nome }}
        </span>
        
        <small class="text-muted fw-bold" style="font-size: 0.8em;">
            ({{ celula.agendamento.usuario.first_name|default:celula.agendamento.usuario.username }})
        </small>

    </div>

{% else %}
    <a href="{% url 'agendar_sala' %}?hora={{ linha.hora_para_link }}&data={{ celula.data|date:'Y-m-d' }}&sala={{ sala.nome }}" 
       class="btn btn-primary btn-sm w-100"
       data-bs-toggle="tooltip" 
       title="Clique para agendar">
        
        <i class="fa-solid fa-plus fa-lg"></i>
        
    </a>
{% endif %}

                                </td>
                            {% endfor %}
                        </tr>
                    {% endif %}

                {% empty %}
                    <tr>
                        <td colspan="6" class="text-center text-muted">
                            Nenhum horário definido na estrutura da view.
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div> </div>

{% endblock %}